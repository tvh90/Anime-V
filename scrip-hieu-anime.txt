local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function getIP()
    local req = (syn and syn.request) or request or (HttpService and HttpService.request) or http_request
    local response = req({
        Url = "https://hvauto.click/GetIP.php",
        Method = "GET"
    })

    local json = HttpService:JSONDecode(response.Body)
    return json.ip
end

local function filterTable(t)
    local filtered = {}
    for k, v in pairs(t) do
        if k ~= "TraitPity" and k ~= "MobileButtonPositions" and k ~= "Clan" and k ~= "Auto_Delete_Items" and k ~= "EquippedEmotes" then
            if type(v) == "table" and v.AllTime and type(v.AllTime) == "table" and v.AllTime.Score then
                filtered[k] = v.AllTime.Score
            elseif type(v) == "table" then
                filtered[k] = filterTable(v)
            else
                filtered[k] = v
            end
        end
    end
    return filtered
end

local function sendMessageToServer(username, playerData, ip)
    local port = "2820"
    local req = (syn and syn.request) or request or (HttpService and HttpService.request) or http_request
    local jsonData = HttpService:JSONEncode({ username = username, data = playerData })

    local response = req({
        Url = "http://" .. ip .. ":" .. port .. "/v1/SendData",
        Method = "POST",
        Headers = {
            ["Content-Type"] = "application/json",
        },
        Body = jsonData
    })
    if response.StatusCode ~= 200 then 
        warn("Failed to send the message. Server responded with: " .. response.Body)
        return false 
    end

    print("Message sent successfully!")
    return response.Body
end

local function updatePlayerData(ip)
    local inventoryFunc = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("GetInventory")
    local result = inventoryFunc:InvokeServer()

    local filteredResult = type(result) == "table" and filterTable(result) or result
    sendMessageToServer(player.Name, filteredResult, ip)
end

local ip = getIP()

while true do
    updatePlayerData(ip)
    wait(10)
end